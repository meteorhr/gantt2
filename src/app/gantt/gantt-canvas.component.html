<!-- src/app/gantt/gantt-canvas.component.html -->

<!-- ВЕРХНИЙ TOOLBAR -->
<div class="page-toolbar">
  <div class="proj-ops">
    <button type="button" (click)="expandAll()" title="Expand all">Expand all</button>
    <button type="button" (click)="collapseAll()" title="Collapse all">Collapse all</button>
  </div>

  <div class="gantt-toolbar">
    @if(showGantt){
      <div class="zoom">
        <button type="button" (click)="bumpScale(-1)" title="Zoom out">−</button>
        <input type="range" min="4" max="60" step="1" [value]="ganttPxPerDay" (input)="onTimescaleInput($event)" />
        <button type="button" (click)="bumpScale(1)" title="Zoom in">+</button>
        <button type="button" (click)="zoomToFit()" title="Zoom to fit all tasks">Fit</button>
        <span class="zoom-label">Timescale</span>
      </div>
      <select [value]="ganttScale" (change)="onScaleChange($event)">
        <option value="week-day">week | day</option>
        <option value="month-week">month | week</option>
        <option value="quarter-month">quarter | month</option>
        <option value="year-month">year | month</option>
        <option value="year-quarter">year | quarter</option>
      </select>
    }
    <button type="button" (click)="toggleGantt()">
      {{ showGantt ? 'Скрыть Gantt' : 'Показать Gantt' }}
    </button>
  </div>
</div>

<!-- ОСНОВНОЕ СОДЕРЖИМОЕ -->
<div class="center">
  <div #splitRoot class="split-root">
    <!-- Левая панель (ТАБЛИЦА) -->
    <div class="pane pane-left" [style.flex-basis.%]="showGantt ? leftPct : 100">
      <div #host class="gantt-host">
        <!-- шапка таблицы -->
        <canvas #headerCanvas class="gantt-header-canvas"></canvas>

        <!-- прокручиваемое тело таблицы -->
        <div #bodyWrapper class="gantt-body-wrapper">
          <canvas #canvas class="gantt-body-overlay"></canvas>
          <div #tableSpacer class="gantt-spacer"></div>
          <!-- overlay-канвас ДОЛЖЕН быть ВНУТРИ wrapper -->

        </div>
      </div>
    </div>

    <!-- Разделитель -->
    <div
      class="splitter"
      (mousedown)="onSplitMouseDown($event)"
      [style.display]="showGantt ? '' : 'none'">
    </div>

    <!-- Правая панель (ГАНТТ) -->
    <div
      class="pane pane-right"
      [style.flex-basis.%]="100 - leftPct"
      [style.display]="showGantt ? '' : 'none'">
      <div #ganttHost class="gantt-host">
        <!-- шапка ганта -->
        <canvas #ganttHeaderCanvas class="gantt-header-canvas"></canvas>

        <!-- прокручиваемое тело ганта -->
        <div #ganttWrapper class="gantt-body-wrapper">
          <canvas #ganttCanvas class="gantt-body-overlay"></canvas>
          <div #ganttSpacer class="gantt-spacer"></div>
        </div>
      </div>
    </div>
  </div>
</div>
