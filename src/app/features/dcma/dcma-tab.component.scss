:host {
  /* дизайн-токены */
  --dcma-gap: 16px;
  --dcma-radius: 10px;
  --dcma-border: 1px solid var(--mat-sys-outline-variant, rgba(0,0,0,.12));
  --dcma-surface: var(--mat-sys-surface, #fff);
  --dcma-surface-alt: var(--mat-sys-surface-container-low, #fafafa);
  --dcma-primary: var(--mat-sys-primary, #1976d2);
  --dcma-ok: #2e7d32;
  --dcma-bad: #c62828;
  --dcma-details-max: 1100px; /* макс. ширина правой «ракушки» */

  display: block;
  color-scheme: light dark;
  box-sizing: border-box;
}

/* ▼ корневой вьюпорт всего таба */
.dash-viewport {
  height: calc(100vh - 150px);   /* фиксированная высота области контента */
  overflow: hidden;              /* скроллы — только у панелей */
  -webkit-overflow-scrolling: touch;
}

/* ▼ грид 30/70, на всю высоту вьюпорта */
.dcma-split {
  display: grid;
  grid-template-columns: 30% 1fr;
  gap: var(--dcma-gap);
  height: 100%;
  min-height: 0;                 /* важно для внутренних overflow */
}
@media (max-width: 960px) {
  .dcma-split { grid-template-columns: 1fr; }
}
@media (min-width: 1600px) {
  .dcma-split { grid-template-columns: 25% 1fr; }
}

/* ▼ левая панель (список чеков) — ровно 100% высоты */
.left-pane {
  height: 100%;
  min-width: 0;
  min-height: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden;              /* скролл — только в .table-scroll */
}

/* шапка слева — не тянется */
.dcma-header {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 8px;
  padding-right: 2px;            /* чтобы тень хэдера таблицы выглядела аккуратно */
  .fx { flex: 1 1 auto; }
}

/* прокручиваемая область списка */
.left-pane .table-scroll {
  flex: 1 1 auto;
  height: calc(100vh - 150px);
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}

/* таблица слева на всю ширину контейнера */
.left-pane table.mat-mdc-table,
.fullw { width: 100%; }

/* липкий заголовок таблиц (работает в пределах скролл-контейнера) */
:host ::ng-deep .mat-mdc-table .mat-mdc-header-row {
  position: sticky;
  top: 0;
  z-index: 1;
  background: var(--dcma-surface);
  box-shadow: 0 1px 0 0 var(--mat-sys-outline-variant, rgba(0,0,0,.08));
}

/* компактная таблица + hover/selected/focus */
:host ::ng-deep .mat-mdc-table .mat-mdc-row,
:host ::ng-deep .mat-mdc-table .mat-mdc-header-row { height: 44px; }

:host ::ng-deep .mat-mdc-table .mat-mdc-cell,
:host ::ng-deep .mat-mdc-table .mat-mdc-header-cell {
  padding: 0 12px;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}
@media (hover: hover) and (pointer: fine) {
  :host ::ng-deep .mat-mdc-table .mat-mdc-row:hover td {
    background: color-mix(in oklab, var(--dcma-primary) 7%, transparent);
  }
}
:host ::ng-deep .mat-mdc-table tr.is-selected td {
  background: color-mix(in oklab, var(--dcma-primary) 12%, transparent);
}
:host ::ng-deep .mat-mdc-table .mat-mdc-row:focus-visible td {
  outline: 2px solid color-mix(in oklab, var(--dcma-primary) 60%, transparent);
  outline-offset: -2px;
}

/* ▼ правая панель (детали) — тоже 100% высоты */
.right-pane {
  height: 100%;
  min-width: 0;
  min-height: 0;
  overflow: auto;    
  overflow-x: hidden;                 /* основной скролл правой панели */
  border-left: var(--dcma-border);
  background: var(--dcma-surface);

  display: grid;
  grid-template-rows: 1fr;       /* внутри — оболочка details-shell */
  align-content: start;
}

/* «ракушка» правого контента — центрируем и ограничиваем ширину */
.details-shell {
  width: min(100%, var(--dcma-details-max));
  margin-inline: auto;
  padding-inline: 12px;
  box-sizing: border-box;       /* включаем паддинги в ширину, чтобы не раздувало */
}

/* липкая шапка деталей (липнет к верху правой панели) */
.details-header {
  position: sticky;
  top: 0;
  z-index: 2;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding-block: 8px 10px;
  margin-inline: 0;             /* было: -12px */
  padding-inline: 12px; 
  background: var(--dcma-surface);
  border-bottom: var(--dcma-border);
  .title { display:flex; align-items:center; gap:8px; }
  .check-num { font-weight: 600; }
  .check-name { font-weight: 500; }
  .meta { display:flex; align-items:center; gap:8px; }
  .percent { font-variant-numeric: tabular-nums; opacity: .85; }
  .status-icon.ok { color: var(--dcma-ok); }
  .status-icon.bad { color: var(--dcma-bad); }
}

/* тело правой панели */
.details-body {
  min-width: 0;
  min-height: 0;
  display: grid;
  gap: 12px;
  align-content: start;

  .desc { opacity: .85; word-break: break-word; }
}

/* мат-табы: ширина не больше «ракушки», скролл — внутри тела таба */
.details-body .mat-mdc-tab-group,
.details-body .mat-mdc-tab-body-wrapper { width: 100%; }

/* скролл контента конкретной вкладки (чтобы большие таблицы не растягивали панель) */
:host ::ng-deep .mat-mdc-tab-body .mat-mdc-tab-body-content {
  overflow: auto;
  max-height: min(60vh, 520px);
}

/* таблицы внутри правой панели */
.details-body table.mat-mdc-table {
  width: 100%;
  table-layout: fixed;           /* стабильная ширина колонок */
}
.details-body .mat-mdc-cell,
.details-body .mat-mdc-header-cell {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* иконки pass/fail */
:host ::ng-deep mat-icon.ok,
:host ::ng-deep .mat-icon.ok { color: var(--dcma-ok); }
:host ::ng-deep mat-icon.bad,
:host ::ng-deep .mat-icon.bad { color: var(--dcma-bad); }
:host ::ng-deep td.mat-mdc-cell mat-icon.ok  { filter: drop-shadow(0 0 0 rgba(46,125,50,.15)); }
:host ::ng-deep td.mat-mdc-cell mat-icon.bad { filter: drop-shadow(0 0 0 rgba(198,40,40,.15)); }

/* плейсхолдер справа */
.placeholder {
  min-height: 240px;
  display: flex;
  align-items: center; justify-content: center;
  gap: 12px; opacity: .7; flex-direction: column; text-align: center;

  mat-icon { font-size: 40px; width: 40px; height: 40px; }
}

/* аккуратные скроллбары */
.right-pane,
.left-pane .table-scroll,
:host ::ng-deep .mat-mdc-tab-body .mat-mdc-tab-body-content {
  scrollbar-width: thin;
  scrollbar-color: color-mix(in oklab, currentColor 35%, transparent) transparent;
}
.right-pane::-webkit-scrollbar,
.left-pane .table-scroll::-webkit-scrollbar,
:host ::ng-deep .mat-mdc-tab-body .mat-mdc-tab-body-content::-webkit-scrollbar { height: 10px; width: 10px; }
.right-pane::-webkit-scrollbar-thumb,
.left-pane .table-scroll::-webkit-scrollbar-thumb,
:host ::ng-deep .mat-mdc-tab-body .mat-mdc-tab-body-content::-webkit-scrollbar-thumb {
  background: color-mix(in oklab, currentColor 25%, transparent);
  border-radius: 10px;
}

/* утилита для скрытого текста */
.visually-hidden {
  position: absolute !important;
  width: 1px; height: 1px; padding: 0; margin: -1px;
  overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap; border: 0;
}

/* уважение prefers-reduced-motion */
@media (prefers-reduced-motion: reduce) {
  * { transition: none !important; animation: none !important; }
}