:host { 
  --dcma-gap: 16px;
  --dcma-radius: 10px;
  --dcma-border: 1px solid var(--mat-sys-outline-variant, rgba(0,0,0,.12));
  --dcma-surface: var(--mat-sys-surface, #fff);
  --dcma-surface-alt: var(--mat-sys-surface-container-low, #fafafa);
  --dcma-primary: var(--mat-sys-primary, #1976d2);
  --dcma-ok: #2e7d32;
  --dcma-bad: #c62828;
  --dcma-details-max: 100%;
  display: block; color-scheme: light dark; box-sizing: border-box;

  /* колонки слева */
  --col-num-ch: 5;
  --col-pct-ch: 7;
}

.dash-viewport { 
  height: calc(100vh - 150px); 
  margin: 10px;
  padding: 10px; 
  background-color: #fff; 
  border-radius: 14px;
  border: 1px solid #e0e0e0; 
  overflow: hidden; 
  -webkit-overflow-scrolling: touch;
}
.dcma-split { display: grid; grid-template-columns: 30% 1fr; gap: var(--dcma-gap); height: 100%; min-height: 0; }
@media (max-width: 960px)  { .dcma-split { grid-template-columns: 1fr; } }
@media (min-width: 1600px) { .dcma-split { grid-template-columns: 25% 1fr; } }

.left-pane { height: 100%; min-width: 0; min-height: 0; display: flex; flex-direction: column; overflow: hidden; }
.dcma-header { flex: 0 0 auto; display: flex; align-items: center; gap: 12px; margin-bottom: 8px; padding-right: 2px; .fx { flex: 1 1 auto; } }
.left-pane .table-scroll { flex: 1 1 auto; height: calc(100vh - 150px); overflow: auto; -webkit-overflow-scrolling: touch; }
.left-pane table.mat-mdc-table, .fullw { width: 100%; }
.left-pane table.mat-mdc-table { table-layout: fixed; }

/* Мат-таблица в левой панели */
:host ::ng-deep .mat-mdc-table .mat-mdc-header-row {
  position: sticky; top: 0; z-index: 1; background: var(--dcma-surface);
  box-shadow: 0 1px 0 0 var(--mat-sys-outline-variant, rgba(0,0,0,.08));
  height: 44px; /* высота шапки */
}
:host ::ng-deep .mat-mdc-table .mat-mdc-row { height: 44px; }

:host ::ng-deep .mat-mdc-table .mat-mdc-header-cell,
:host ::ng-deep .mat-mdc-table .mat-mdc-cell {
  padding: 0 12px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; vertical-align: middle;
  text-align: left; /* ← текст шапки и ячеек слева */
  position: relative; /* для псевдоэлемента-акцента */
}
:host ::ng-deep .mat-mdc-table .mat-mdc-header-cell { font-weight: 600; }

/* hover / selected улучшены */
:host ::ng-deep .mat-mdc-table .mat-mdc-row td { transition: background-color .15s ease; }
@media (hover:hover) and (pointer:fine) {
  :host ::ng-deep .mat-mdc-table .mat-mdc-row:hover td {
    background: color-mix(in oklab, var(--dcma-primary) 7%, transparent);
  }
  :host ::ng-deep .mat-mdc-table .mat-mdc-row:hover td:first-child::before {
    content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
    background: color-mix(in oklab, var(--dcma-primary) 50%, transparent);
    border-radius: 0 2px 2px 0;
  }
}
:host ::ng-deep .mat-mdc-table tr.is-selected td {
  background: color-mix(in oklab, var(--dcma-primary) 12%, transparent);
}
:host ::ng-deep .mat-mdc-table .mat-mdc-row:focus-visible td {
  outline: 2px solid color-mix(in oklab, var(--dcma-primary) 60%, transparent); outline-offset: -2px;
}

.right-pane {
  height: 100%; min-width: 0; min-height: 0; overflow: auto; overflow-x: hidden;
  border-left: var(--dcma-border); background: var(--dcma-surface);
  display: grid; grid-template-rows: 1fr; align-content: start;
}
.details-shell { width: min(100%, var(--dcma-details-max)); margin-inline: auto; padding-inline: 12px; box-sizing: border-box; }
.details-header {
  position: sticky; top: 0; z-index: 2; display: flex; align-items: center; justify-content: space-between; gap: 12px;
  padding-block: 8px 10px; padding-inline: 12px; background: var(--dcma-surface); border-bottom: var(--dcma-border);
  .title { display:flex; align-items:center; gap:8px; } .check-num { font-weight: 600; } .check-name { font-weight: 500; }
  .meta { display:flex; align-items:center; gap:8px; } .percent { font-variant-numeric: tabular-nums; opacity: .85; }
  .status-icon.ok { color: var(--dcma-ok); } .status-icon.bad { color: var(--dcma-bad); }
}

/* Грид правой области с одной колонкой на 100% */
.details-body {
  min-width: 0; 
  min-height: 0; 
  display: grid; 
  gap: 12px; 
  align-content: start; 
  grid-template-columns: minmax(0, 1fr); /* FIX: колонка не shrink-wrap'ится к содержимому */
  .desc { opacity: .85; word-break: break-word; }
}
/* FIX: любой прямой потомок (в т.ч. mat-tab-group) может растягиваться, не участвуя в min-content sizing */
.details-body > * { min-width: 0; }

/* Точечное: mat-tab — ширина 100% */
.details-body .mat-mdc-tab-group,
.details-body .mat-mdc-tab-body-wrapper { width: 100%; }

/* FIX: принудительно делаем группу блочной и не даём ей сжиматься до контента */
:host ::ng-deep .mat-mdc-tab-group { display: block; width: 100%; min-width: 0; }
:host ::ng-deep .mat-mdc-tab-header { width: 100%; } /* шапка табов на всю ширину */
:host ::ng-deep .mat-mdc-tab-body-wrapper { width: 100%; min-width: 0; }
:host ::ng-deep .mat-mdc-tab-body,
:host ::ng-deep .mat-mdc-tab-body .mat-mdc-tab-body-content { width: 100%; min-width: 0; } /* контент табов на всю ширину */

:host ::ng-deep .mat-mdc-tab-body .mat-mdc-tab-body-content { overflow: auto; max-height: calc(100vh - 250px); }
.details-body table.mat-mdc-table { width: 100%; table-layout: fixed; }
.details-body .mat-mdc-cell, .details-body .mat-mdc-header-cell { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; }

:host ::ng-deep mat-icon.ok, :host ::ng-deep .mat-icon.ok { color: var(--dcma-ok); }
:host ::ng-deep mat-icon.bad, :host ::ng-deep .mat-icon.bad { color: var(--dcma-bad); }
:host ::ng-deep td.mat-mdc-cell mat-icon.ok  { filter: drop-shadow(0 0 0 rgba(46,125,50,.15)); }
:host ::ng-deep td.mat-mdc-cell mat-icon.bad { filter: drop-shadow(0 0 0 rgba(198,40,40,.15)); }

.placeholder { min-height: 240px; display: flex; align-items: center; justify-content: center; gap: 12px; opacity:.7; flex-direction: column; text-align: center;
  mat-icon { font-size: 40px; width: 40px; height: 40px; } }

/* Скроллбары */
.right-pane, .left-pane .table-scroll, :host ::ng-deep .mat-mdc-tab-body .mat-mdc-tab-body-content {
  scrollbar-width: thin; scrollbar-color: color-mix(in oklab, currentColor 35%, transparent) transparent;
}
.right-pane::-webkit-scrollbar, .left-pane .table-scroll::-webkit-scrollbar, :host ::ng-deep .mat-mdc-tab-body .mat-mdc-tab-body-content::-webkit-scrollbar { height: 10px; width: 10px; }
.right-pane::-webkit-scrollbar-thumb, .left-pane .table-scroll::-webkit-scrollbar-thumb, :host ::ng-deep .mat-mdc-tab-body .mat-mdc-tab-body-content::-webkit-scrollbar-thumb {
  background: color-mix(in oklab, currentColor 25%, transparent); border-radius: 10px;
}

/* KPI */
.kpi { display: flex; align-items: center; gap: 8px; white-space: nowrap; }
.kpi .mat-icon { flex: 0 0 auto; }
.kpi .value { opacity: .8; font-variant-numeric: tabular-nums; }

/* Сегментная шкала */
.grade-cell {
  --q: 0%;
  --thumb: #2e7d32;
  --track: color-mix(in oklab, currentColor 12%, transparent);
  position: relative; flex: 1 1 140px; min-width: 140px; height: 12px;
  border-radius: 999px; background: var(--track);
  border: 1px solid color-mix(in oklab, currentColor 10%, transparent);
  box-sizing: border-box; overflow: hidden; contain: paint; will-change: width;
}
.grade-cell::before { display: none; }
.grade-cell::after {
  content: ''; position: absolute; top: 50%;
  left: clamp(6px, var(--q), calc(100% - 6px)); transform: translate(-50%, -50%);
  width: 12px; height: 12px; border-radius: 50%; background: var(--thumb);
  box-shadow: 0 0 0 2px var(--dcma-surface), 0 0 0 3px color-mix(in oklab, var(--thumb) 50%, transparent);
}
.grade-cell.na::after { display: none; }

/* уважение prefers-reduced-motion */
@media (prefers-reduced-motion: reduce) { * { transition: none !important; animation: none !important; } }

/* значения в ячейке процента */
.value-cell { display: inline-flex; align-items: center; gap: 8px; justify-content: flex-end; width: 100%; }
.value-dot { flex: 0 0 auto; width: 10px; height: 10px; border-radius: 50%; }
.value-text { min-width: calc(var(--col-pct-ch) * 1ch); text-align: right; font-variant-numeric: tabular-nums; white-space: nowrap; }

/* Узкие ширины */
:host ::ng-deep th.mat-mdc-header-cell.mat-column-check,
:host ::ng-deep td.mat-mdc-cell.mat-column-check {
  width: calc(var(--col-num-ch) * 1ch);
  min-width: calc(var(--col-num-ch) * 1ch);
  max-width: calc(var(--col-num-ch) * 1ch);
  padding-inline: 8px; text-align: right; font-variant-numeric: tabular-nums;
}
:host ::ng-deep th.mat-mdc-header-cell.mat-column-percent,
:host ::ng-deep td.mat-mdc-cell.mat-column-percent {
  width: calc(34px + var(--col-pct-ch) * 1ch);
  min-width: calc(34px + var(--col-pct-ch) * 1ch);
  max-width: calc(34px + var(--col-pct-ch) * 1ch);
  padding-inline: 8px;
}
:host ::ng-deep th.mat-mdc-header-cell.mat-column-metric,
:host ::ng-deep td.mat-mdc-cell.mat-column-metric { width: auto; }

/* === Summary (card) === */
.c1-summary {
  --c: var(--dcma-primary);
  position: relative; margin: 22px auto; padding: 16px 20px; max-width: 420px;
  border: 2px solid transparent; border-radius: 20px; text-align: left;
  background: color-mix(in oklab, var(--c) 6%, transparent);
}
.c1-summary__line { margin: 6px 0; font-variant-numeric: tabular-nums; }
.c1-summary__border { position: absolute; inset: 0; z-index: 1; pointer-events: none; }
.c1-summary__border path {
  fill: none; stroke: var(--c); stroke-width: 2px; vector-effect: non-scaling-stroke;
  stroke-linejoin: round; stroke-linecap: butt; stroke-dasharray: 1; stroke-dashoffset: 1;
}
.c1-summary.animate-border .c1-summary__border path { animation: c1-border-draw 900ms ease-out forwards;
  filter: drop-shadow(0 0 2px color-mix(in oklab, var(--c) 50%, transparent)); }
@keyframes c1-border-draw { to { stroke-dashoffset: 0; } }

.c1-summary{ --big: clamp(36px, 7vw, 72px); --muted: color-mix(in oklab, currentColor 45%, transparent); }
.c1-summary__title{ margin: 0 0 10px; font-weight: 700; font-size: clamp(18px, 2.4vw, 26px); }
.c1-summary__percent,
.c1-summary__pass{
  margin: 2px 0 12px; line-height: .95; font-weight: 800; font-size: var(--big);
  font-variant-numeric: tabular-nums; letter-spacing: .5px; color: var(--c);
}
.c1-summary__desc{ margin: 6px auto 14px; max-width: 60ch; line-height: 1.45; font-size: 14px; color: var(--muted); }
.c1-summary__great{ font-size: 16px; opacity: .9; margin: 0 0 12px; }

/* PASS/FAIL в левой таблице */
.status-chip {
  display: inline-flex; align-items: center; justify-content: center;
  min-width: 54px; padding: 2px 8px; border-radius: 999px;
  font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: .5px;
  border: 1px solid currentColor; opacity: .95;
}
.status-chip.ok  { color: var(--dcma-ok);  background: color-mix(in oklab, var(--dcma-ok) 12%,  transparent); }
.status-chip.bad { color: var(--dcma-bad); background: color-mix(in oklab, var(--dcma-bad) 12%, transparent); }

/* === «Нормальная» виртуальная таблица (правый блок) === */
.vtable { width: 100%; display: grid; grid-template-rows: auto 1fr; }
.vtable__head, .vtable__body { width: 100%; table-layout: fixed; border-collapse: collapse; }
.vtable__head thead th, .vtable__body tbody td {
  padding: 8px 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left;
}
.vtable__head thead th {
  height: 44px; /* высота шапки */
  line-height: 44px;
  border-bottom: 1px solid color-mix(in oklab, currentColor 10%, transparent);
  background: var(--dcma-surface);
  position: sticky; top: 0; z-index: 1;
  font-weight: 600;
}
.vtable__body tbody tr {
  height: 44px; /* ← синхронизировано с [itemSize] */
  border-bottom: 1px solid color-mix(in oklab, currentColor 8%, transparent);
}
.vtable__body tbody td { position: relative; transition: background-color .15s ease; }
@media (hover:hover) and (pointer:fine) {
  .vtable__body tbody tr:hover td { background: color-mix(in oklab, var(--dcma-primary) 7%, transparent); }
  .vtable__body tbody tr:hover td:first-child::before {
    content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
    background: color-mix(in oklab, var(--dcma-primary) 50%, transparent);
    border-radius: 0 2px 2px 0;
  }
}

/* высота области прокрутки справа */
.v-viewport {
  height: calc(100vh - 320px);
  min-height: 240px;
  overflow: auto;
}
